<!-- Page Content -->

<!--=====================================-->
<!--=        Newsfeed  Area Start       =-->
<!--=====================================-->
<div class="container">
    <!-- Banner Area Start -->
    <div class="banner-user">
        <div class="banner-content">
            <div class="media">
                <div class="item-img">
                    <img src="{{userInfo.avatar}}" alt="{{userInfo.username}}">
                </div>
                <div class="media-body">
                    <h3 class="item-title">{{userInfo.fullName}}</h3>
                    <div class="item-subtitle">@{{userInfo.username}}</div>
                    <ul class="item-social">
                        {{#if userInfo.facebook}}
                            <li><a target="_blank" href="https://www.facebook.com/{{userInfo.facebook}}"
                                   class="bg-fb"><i class="icofont-facebook"></i></a></li>{{/if}}
                        {{#if userInfo.twitter}}
                            <li><a target="_blank" href="https://www.twitter.com/{{userInfo.twitter}}"
                                   class="bg-twitter"><i class="icofont-twitter"></i></a></li>{{/if}}
                        {{#if userInfo.instagram}}
                            <li><a target="_blank" href="https://www.instagram.com/{{userInfo.instagram}}"
                                   class="bg-dribble"><i class="icofont-instagram"></i></a></li>{{/if}}
                        {{#if userInfo.youtube}}
                            <li><a target="_blank" href="https://www.youtube.com/channel/{{userInfo.youtube}}"
                                   class="bg-youtube"><i class="icofont-brand-youtube"></i></a></li>{{/if}}
                    </ul>
                    <ul class="user-meta">
                        <li>Posts: <span>{{totalPosts}}</span></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="block-box user-top-header">
        <ul class="menu-list">
            <li class="active"><a href="javascript:void(0)">Timeline</a></li>
        </ul>
    </div>
    <div class="row gutters-20">
        <div class="col-lg-8 order-2">
            {{#each posts}}
                <div class="block-box post-view">
                    <div class="post-header">
                        <div class="media">
                            <div class="user-img">
                                <img src="{{this.authorAvatar}}" alt="{{this.authorUsername}}">
                            </div>
                            <div class="media-body">
                                <div class="user-title"><a
                                        href="/community/timeline/@{{this.authorUsername}}">{{this.authorName}}</a>
                                </div>
                                <ul class="entry-meta">
                                    <li class="meta-time">{{this.createdDate}}</li>
                                </ul>
                            </div>
                        </div>
                        {{#if ../session.authUser}}
                            <div class="dropdown">
                                <button class="dropdown-toggle" type="button" data-toggle="dropdown"
                                        aria-expanded="false">
                                    ...
                                </button>
                                <div class="dropdown-menu dropdown-menu-right">
                                    <button type="button" class="dropdown-item" value="{{this._id}}">Report</button>
                                </div>
                            </div>
                        {{/if}}
                    </div>
                    <div class="post-body">
                        <div class="post-no-thumbnail">
                            <div class="postPuretext">
                                <p>{{this.postText}}</p>
                            </div>
                            {{#if this.postImage}}
                                <div class="post-img">
                                    <img src="{{this.postImage}}" alt="Post">
                                </div>
                            {{/if}}
                        </div>
                        <div class="post-meta-wrap">
                            <div class="post-meta">
                                <div class="meta-text openModalReactions" data-postid="{{this._id}}"><span
                                        id="reactions_count_{{this._id}}">{{this.countReactions}}</span> Reactions
                                </div>
                                <div class="meta-text openModalComments">2 Comments</div>
                                <div class="meta-text">5 Share</div>
                            </div>
                        </div>
                    </div>
                    <div class="post-footer">
                        <ul>
                            {{#if ../session.authUser}}
                                <li class="post-react">
                                    {{#if this.isReaction}}
                                        <a id="postid_{{this._id}}" class="reacted"
                                           data-current-reaction="{{this.myReaction.0.type}}"
                                           style="background: var(--{{this.myReaction.0.type}}-color)"
                                           href="javascript:void(0)">
                                            <img class="reactionbtn"
                                                 src="/media/reactions/{{this.myReaction.0.type}}.svg"
                                                 alt="Wink">&nbsp;
                                            <span>{{this.myReaction.0.type}}!</span>
                                        </a>
                                    {{else}}
                                        <a id="postid_{{this._id}}" href="javascript:void(0)"><img class="reactionbtn"
                                                                                                   src="/media/reactions/Wink.svg"
                                                                                                   alt="Wink">&nbsp;<span>React!</span></a>
                                    {{/if}}
                                    <ul class="react-list">
                                        <li><a href="javascript:void(0)" data-reaction="Wink"
                                               data-postid="{{this._id}}"><img src="/media/reactions/Wink.svg"
                                                                               alt="Wink"></a></li>
                                        <li><a href="javascript:void(0)" data-reaction="Hearts"
                                               data-postid="{{this._id}}"><img src="/media/reactions/Hearts.svg"
                                                                               alt="Hearts"></a></li>
                                        <li><a href="javascript:void(0)" data-reaction="Amazed"
                                               data-postid="{{this._id}}"><img src="/media/reactions/Amazed.svg"
                                                                               alt="Amazed"></a></li>
                                        <li><a href="javascript:void(0)" data-reaction="Tears"
                                               data-postid="{{this._id}}"><img src="/media/reactions/Tears.svg"
                                                                               alt="Tears"></a>
                                        </li>
                                        <li><a href="javascript:void(0)" data-reaction="Frown"
                                               data-postid="{{this._id}}"><img src="/media/reactions/Frown.svg"
                                                                               alt="Frown"></a>
                                        </li>
                                    </ul>
                                </li>
                                <li><a href="javascript:void(0)" class="openModalComments" data-postid="1"><i
                                        class="icofont-comment"></i>Comment</a></li>
                            {{/if}}
                            <li class="post-share">
                                <a href="javascript:void(0);" class="share-btn"><i class="icofont-share"></i>Share</a>
                                <ul class="share-list {{#if ../session.authUser}}{{else}}share-list-onlyitem{{/if}}">
                                    <li><a href="#" class="color-fb"><i class="icofont-facebook"></i></a></li>
                                    <li><a href="#" class="color-messenger"><i
                                            class="icofont-facebook-messenger"></i></a>
                                    </li>
                                    <li><a href="#" class="color-instagram"><i class="icofont-instagram"></i></a></li>
                                    <li><a href="#" class="color-whatsapp"><i class="icofont-brand-whatsapp"></i></a>
                                    </li>
                                    <li><a href="#" class="color-twitter"><i class="icofont-twitter"></i></a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            {{/each}}
            {{#if posts}}
                <div class="block-box load-more-btn">
                    <a href="#" class="item-btn"><i class="icofont-refresh"></i>Load More Posts</a>
                </div>
            {{else}}
                <div class="text-center mt-5 mb-3">
                    <img src="/media/emptyTimeline.svg" class="emptyTimelineImg">
                    <p>Δεν υπάρχουν διαθέσιμες δημοσιεύσεις ακόμη!</p>
                </div>
            {{/if}}
        </div>
        <div class="col-lg-4 widget-block widget-break-lg order-1">
            <div class="widget widget-user-about">
                <div class="widget-heading">
                    <h3 class="widget-title">About &nbsp;{{userInfo.username}}</h3>
                </div>
                <div class="user-info">
                    {{#if userInfo.aboutYou}}
                        <p>{{userInfo.aboutYou}}</p>
                    {{/if}}
                    <ul class="info-list">
                        <li><span>Joined:</span>{{userInfo.registerDate}}</li>
                        <li><span>E-mail:</span>{{userInfo.email}}</li>
                        <li><span>Username:</span>@{{userInfo.username}}</li>
                        {{#if userInfo.website}}
                            <li><span>Web:</span><a href="#">{{userInfo.website}}</a></li>{{/if}}
                        <li class="social-share"><span>Social:</span>
                            <div class="social-icon">
                                {{#if userInfo.facebook}}
                                    <a target="_blank" href="https://www.facebook.com/{{userInfo.facebook}}"><i
                                            class="icofont-facebook"></i></a>{{/if}}
                                {{#if userInfo.twitter}}
                                    <a target="_blank" href="https://www.twitter.com/{{userInfo.twitter}}"><i
                                            class="icofont-twitter"></i></a>{{/if}}
                                {{#if userInfo.instagram}}
                                    <a target="_blank" href="https://www.instagram.com/{{userInfo.instagram}}"><i
                                            class="icofont-instagram"></i></a>{{/if}}
                                {{#if userInfo.youtube}}
                                    <a target="_blank" href="https://www.youtube.com/channel/{{userInfo.youtube}}"><i
                                            class="icofont-youtube"></i></a>{{/if}}
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Modal Comments -->
<div class="modal fade" id="postModal" tabindex="-1" role="dialog" aria-labelledby="postModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <button type="button" class="btn close_modal" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <div class="modal-post">
                    <div class="">
                        <div class="post-view">
                            <div class="post-comment">
                                <div class="text-center">
                                    <p>Comments (20)</p>
                                </div>
                                <ul class="comment-list">
                                    <li class="main-comments">
                                        <div class="each-comment">
                                            <div class="post-header">
                                                <div class="media">
                                                    <div class="user-img">
                                                        <img src="/media/figure/chat_14.jpg" alt="Aahat">
                                                    </div>
                                                    <div class="media-body">
                                                        <div class="user-title"><a href="/community/timeline">Aahat
                                                            Akter</a>
                                                        </div>
                                                        <ul class="entry-meta">
                                                            <li class="meta-time">5 mins ago</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="dropdown">
                                                    <button class="dropdown-toggle" type="button"
                                                            data-toggle="dropdown"
                                                            aria-expanded="false">
                                                        ...
                                                    </button>
                                                    <div class="dropdown-menu dropdown-menu-right">
                                                        <a class="dropdown-item" href="#">Close</a>
                                                        <a class="dropdown-item" href="#">Edit</a>
                                                        <a class="dropdown-item" href="#">Delete</a>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="post-body">
                                                <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem
                                                    accusantium der
                                                    doloremque laudantiumSed ut perspicia tisery..</p>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="main-comments">
                                        <div class="each-comment">
                                            <div class="post-header">
                                                <div class="media">
                                                    <div class="user-img">
                                                        <img src="/media/figure/chat_14.jpg" alt="Aahat">
                                                    </div>
                                                    <div class="media-body">
                                                        <div class="user-title"><a href="/community/timeline">Aahat
                                                            Akter</a>
                                                        </div>
                                                        <ul class="entry-meta">
                                                            <li class="meta-time">5 mins ago</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="dropdown">
                                                    <button class="dropdown-toggle" type="button"
                                                            data-toggle="dropdown"
                                                            aria-expanded="false">
                                                        ...
                                                    </button>
                                                    <div class="dropdown-menu dropdown-menu-right">
                                                        <a class="dropdown-item" href="#">Close</a>
                                                        <a class="dropdown-item" href="#">Edit</a>
                                                        <a class="dropdown-item" href="#">Delete</a>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="post-body">
                                                <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem
                                                    accusantium der
                                                    doloremque laudantiumSed ut perspicia tisery..</p>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="main-comments">
                                        <div class="each-comment">
                                            <div class="post-header">
                                                <div class="media">
                                                    <div class="user-img">
                                                        <img src="/media/figure/chat_14.jpg" alt="Aahat">
                                                    </div>
                                                    <div class="media-body">
                                                        <div class="user-title"><a href="/community/timeline">Aahat
                                                            Akter</a>
                                                        </div>
                                                        <ul class="entry-meta">
                                                            <li class="meta-time">5 mins ago</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="dropdown">
                                                    <button class="dropdown-toggle" type="button"
                                                            data-toggle="dropdown"
                                                            aria-expanded="false">
                                                        ...
                                                    </button>
                                                    <div class="dropdown-menu dropdown-menu-right">
                                                        <a class="dropdown-item" href="#">Close</a>
                                                        <a class="dropdown-item" href="#">Edit</a>
                                                        <a class="dropdown-item" href="#">Delete</a>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="post-body">
                                                <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem
                                                    accusantium der
                                                    doloremque laudantiumSed ut perspicia tisery..</p>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="main-comments">
                                        <div class="each-comment">
                                            <div class="post-header">
                                                <div class="media">
                                                    <div class="user-img">
                                                        <img src="/media/figure/chat_14.jpg" alt="Aahat">
                                                    </div>
                                                    <div class="media-body">
                                                        <div class="user-title"><a href="/community/timeline">Aahat
                                                            Akter</a>
                                                        </div>
                                                        <ul class="entry-meta">
                                                            <li class="meta-time">5 mins ago</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="dropdown">
                                                    <button class="dropdown-toggle" type="button"
                                                            data-toggle="dropdown"
                                                            aria-expanded="false">
                                                        ...
                                                    </button>
                                                    <div class="dropdown-menu dropdown-menu-right">
                                                        <a class="dropdown-item" href="#">Close</a>
                                                        <a class="dropdown-item" href="#">Edit</a>
                                                        <a class="dropdown-item" href="#">Delete</a>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="post-body">
                                                <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem
                                                    accusantium der
                                                    doloremque laudantiumSed ut perspicia tisery..</p>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="main-comments">
                                        <div class="each-comment">
                                            <div class="post-header">
                                                <div class="media">
                                                    <div class="user-img">
                                                        <img src="/media/figure/chat_14.jpg" alt="Aahat">
                                                    </div>
                                                    <div class="media-body">
                                                        <div class="user-title"><a href="/community/timeline">Aahat
                                                            Akter</a>
                                                        </div>
                                                        <ul class="entry-meta">
                                                            <li class="meta-time">5 mins ago</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="dropdown">
                                                    <button class="dropdown-toggle" type="button"
                                                            data-toggle="dropdown"
                                                            aria-expanded="false">
                                                        ...
                                                    </button>
                                                    <div class="dropdown-menu dropdown-menu-right">
                                                        <a class="dropdown-item" href="#">Close</a>
                                                        <a class="dropdown-item" href="#">Edit</a>
                                                        <a class="dropdown-item" href="#">Delete</a>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="post-body">
                                                <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem
                                                    accusantium der
                                                    doloremque laudantiumSed ut perspicia tisery..</p>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                                <div class="load-more-btn">
                                    <a href="#" class="item-btn">Load More Comments <span>4+</span></a>
                                </div>
                                <div class="comment-reply">
                                    <div class="user-img">
                                        <img src="/media/figure/chat_15.jpg" alt="Aahat">
                                    </div>
                                    <div class="input-box">
                                        <input type="text" name="comment" class="form-control"
                                               placeholder="Your Reply....">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Modal Reactions -->
<div class="modal fade" id="reactionModal" tabindex="-1" role="dialog" aria-labelledby="postModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <button type="button" class="btn close_modal" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <div class="modal-post">
                    <div class="reactionModal">
                        <div class="post-view">
                            <div class="panel with-nav-tabs panel-default">
                                <div class="panel-heading modal-reactions mt-3 mb-3">
                                    <ul class="nav nav-tabs" id="likes"></ul>
                                </div>
                                <div class="panel-body modal-reaction-memebers">
                                    <div class="tab-content" id="accountReacted"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(".openModalComments").click(function () {
        // alert($(this).attr("data-postid"));
        $("#postModal").modal("show");
    });
    $(".openModalReactions").click(function () {
        $("#reactionModal #likes").empty();
        $("#reactionModal #accountReacted").empty();
        $("#reactionModal").modal("show");
        $.ajax({
            url: '/community/getReactions/' + $(this).attr("data-postid"),
            method: "GET",
            success: function (data) {
                if (data.length) {
                    var tabIndex = 0;
                    $.each(data, function (i, item) {
                        if (tabIndex == 0) {
                            var likeBox = "<li class='col text-center'><a class='active' href='#tab" + item._id + "' data-toggle='tab'><img class='reactionbtn-modal' src='/media/reactions/" + item._id + ".svg'alt='" + item._id + "'><span>" + item.totalReactions + "</span></a></li>";
                            $("#likes").append(likeBox);
                            var tab = "<div class='tab-pane fade active show' id='tab" + item._id + "'> <div class='widget widget-memebers'> <div class='widget-heading'> <h3 class='widget-title'>" + item._id + "</h3> </div> <div class='tab-content'> <div class='tab-pane fade show active' id='newest-member' role='tabpanel'> <div class='members-list' id='memberList" + item._id + "'> </div> </div> </div> </div> </div>";
                            $("#accountReacted").append(tab);
                        } else {
                            var likeBox = "<li class='col text-center'><a href='#tab" + item._id + "' data-toggle='tab'><img class='reactionbtn-modal' src='/media/reactions/" + item._id + ".svg'alt='" + item._id + "'><span>" + item.totalReactions + "</span></a></li>";
                            $("#likes").append(likeBox);
                            var tab = "<div class='tab-pane fade' id='tab" + item._id + "'> <div class='widget widget-memebers'> <div class='widget-heading'> <h3 class='widget-title'>" + item._id + "</h3> </div> <div class='tab-content'> <div class='tab-pane fade show active' id='newest-member' role='tabpanel'> <div class='members-list' id='memberList" + item._id + "'> </div> </div> </div> </div> </div>";
                            $("#accountReacted").append(tab);
                        }

                        $.each(item.userData, function (i, user) {
                            var x = "<div class='media'> <div class='item-img'> <a href='/community/timeline/@" + user.username + "'> <img src='" + user.avatar + "' alt=''> </a> </div> <div class='media-body'> <h4 class='item-title'><a href='/community/timeline/@" + user.username + "'>" + user.fullName + "</a></h4> <div class='item-username'>@" + user.username + "</div> </div> </div>";
                            $('#memberList' + item._id).append(x);
                        })
                        tabIndex++;
                    });
                } else {
                    var emptyReactions = "<div class='text-center mr-auto ml-auto'><p>Δεν υπάρχουν αντιδράσεις σε αυτή τη δημοσίευση!</p></div>";
                    $("#likes").append(emptyReactions);
                }
            }
        })
    });

    function readURL(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                $('#imagePreview').css('background-image', 'url(' + e.target.result + ')');
                $('#imagePreview').hide();
                $('#previewImg').show();
                $('#imagePreview').fadeIn(650);
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    $("#imageUpload").change(function () {
        readURL(this);
    });
</script>
<script src="/javascripts/reactionSystem.js"></script>